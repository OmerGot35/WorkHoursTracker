<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work Hours Tracker</title>
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #sign-in-button {
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    #sign-out-button {
      padding: 10px;
      background-color: #f44336;
      color: white;
      border: none;
      cursor: pointer;
    }
    #save-button, #load-button {
      padding: 10px;
      background-color: #008CBA;
      color: white;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Work Hours Tracker</h1>
  <button id="sign-in-button" onclick="handleSignIn()">Sign In</button>
  <button id="sign-out-button" onclick="handleSignOut()" style="display:none;">Sign Out</button>
  <div id="buttons" style="display:none;">
    <button id="save-button" onclick="saveDataToGoogleDrive()">Save Work Hours</button>
    <button id="load-button" onclick="loadDataFromGoogleDrive()">Load Work Hours</button>
  </div>

  <script>
    const CLIENT_ID = '1030264403343-bc3g0kfsub6b8j91snvnr542p766j75u.apps.googleusercontent.com'; // Replace with your client ID
    const API_KEY = 'AIzaSyCIP3fKpsSJCByo6uETx6CPwxhEemKyDzM'; // Replace with your API key
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';

    let gapiLoaded = false;

    // Load Google API client
    function loadGoogleApiClient() {
      gapi.load('client:auth2', initClient);
    }

    // Initialize Google API client
    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
        scope: SCOPES
      }).then(() => {
        gapiLoaded = true;
        updateUI();
      });
    }

    // Handle Google Sign-In
    function handleSignIn() {
      gapi.auth2.getAuthInstance().signIn().then(() => {
        updateUI();
      });
    }

    // Handle Google Sign-Out
    function handleSignOut() {
      gapi.auth2.getAuthInstance().signOut().then(() => {
        updateUI();
      });
    }

    // Update the UI based on authentication status
    function updateUI() {
      const isSignedIn = gapi.auth2.getAuthInstance().isSignedIn.get();
      if (isSignedIn) {
        document.getElementById('sign-in-button').style.display = 'none';
        document.getElementById('sign-out-button').style.display = 'inline-block';
        document.getElementById('buttons').style.display = 'block';
      } else {
        document.getElementById('sign-in-button').style.display = 'inline-block';
        document.getElementById('sign-out-button').style.display = 'none';
        document.getElementById('buttons').style.display = 'none';
      }
    }

    // Save work hours data to Google Drive
    function saveDataToGoogleDrive() {
      const workHoursData = {
        "start_time": "9:00 AM",
        "end_time": "5:00 PM",
        "total_hours": "8 hours"
      };

      const fileMetadata = {
        name: 'work_hours.json',
        mimeType: 'application/json'
      };

      const media = {
        mimeType: 'application/json',
        body: JSON.stringify(workHoursData)
      };

      gapi.client.drive.files.create({
        resource: fileMetadata,
        media: media,
        fields: 'id'
      }).then((response) => {
        console.log('File created with ID:', response.result.id);
      }).catch((error) => {
        console.error('Error uploading file:', error);
      });
    }

    // Load work hours data from Google Drive
    function loadDataFromGoogleDrive() {
      gapi.client.drive.files.list({
        q: "name = 'work_hours.json'", // Search for the file by name
        fields: "files(id, name)"
      }).then((response) => {
        const files = response.result.files;
        if (files && files.length > 0) {
          const fileId = files[0].id;
          console.log('Found file with ID:', fileId);
          downloadFile(fileId);
        } else {
          console.log('No work_hours.json file found');
        }
      }).catch((error) => {
        console.error('Error fetching files:', error);
      });
    }

    // Download the work hours file from Google Drive
    function downloadFile(fileId) {
      gapi.client.drive.files.get({
        fileId: fileId,
        alt: 'media'
      }).then((response) => {
        const fileData = JSON.parse(response.body); // Parse JSON response
        console.log('File content:', fileData);
      }).catch((error) => {
        console.error('Error downloading file:', error);
      });
    }

    // Load the Google API client
    loadGoogleApiClient();
  </script>
</body>
</html>
